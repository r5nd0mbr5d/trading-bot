2026-02-25 09:44:05,376 [INFO] src.cli.runtime: [OK] Broker provider is IBKR
2026-02-25 09:44:05,377 [INFO] src.cli.runtime: [OK] Market timezone is Europe/London
2026-02-25 09:44:05,378 [INFO] src.cli.runtime: [OK] Base currency is GBP
2026-02-25 09:44:05,379 [INFO] src.cli.runtime: [OK] Detected UK symbols: HSBA.L, VOD.L, BP.L, BARC.L, SHEL.L
2026-02-25 09:44:05,380 [INFO] src.cli.runtime: [OK] DB isolation paths set (paper=trading_paper.db, live=trading_live.db, test=trading_test.db)
2026-02-25 09:44:05,417 [INFO] ib_insync.client: Connecting to 127.0.0.1:7497 with clientId 1...
2026-02-25 09:44:05,418 [INFO] ib_insync.client: Connected
2026-02-25 09:44:05,431 [INFO] ib_insync.client: Logged on to server version 176
2026-02-25 09:44:05,433 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:hfarm
2026-02-25 09:44:05,433 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:eufarmnj
2026-02-25 09:44:05,433 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:cashfarm
2026-02-25 09:44:05,433 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:usfuture
2026-02-25 09:44:05,433 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:jfarm
2026-02-25 09:44:05,434 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:usfarm.nj
2026-02-25 09:44:05,434 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:eufarm
2026-02-25 09:44:05,434 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:usfarm
2026-02-25 09:44:05,434 [INFO] ib_insync.wrapper: Warning 2106, reqId -1: HMDS data farm connection is OK:euhmds
2026-02-25 09:44:05,434 [INFO] ib_insync.wrapper: Warning 2106, reqId -1: HMDS data farm connection is OK:fundfarm
2026-02-25 09:44:05,435 [INFO] ib_insync.wrapper: Warning 2106, reqId -1: HMDS data farm connection is OK:ushmds
2026-02-25 09:44:05,435 [INFO] ib_insync.wrapper: Warning 2158, reqId -1: Sec-def data farm connection is OK:secdefnj
2026-02-25 09:44:05,435 [INFO] ib_insync.client: API connection ready
2026-02-25 09:44:05,437 [INFO] ib_insync.wrapper: position: Position(account='DUQ117408', contract=Stock(conId=909083, symbol='HSBA', exchange='LSE', currency='GBP', localSymbol='HSBA', tradingClass='SET1'), position=10.0, avgCost=13.81023)
2026-02-25 09:44:05,437 [INFO] ib_insync.wrapper: position: Position(account='DUQ117408', contract=Stock(conId=908940, symbol='BARC', exchange='LSE', currency='GBP', localSymbol='BARC', tradingClass='SET1'), position=2.0, avgCost=7.58785)
2026-02-25 09:44:05,437 [INFO] ib_insync.wrapper: position: Position(account='DUQ117408', contract=Stock(conId=140148322, symbol='VOD', exchange='LSE', currency='GBP', localSymbol='VOD', tradingClass='SET1'), position=690.0, avgCost=1.1878884)
2026-02-25 09:44:05,539 [INFO] ib_insync.wrapper: updatePortfolio: PortfolioItem(contract=Stock(conId=908940, symbol='BARC', right='0', primaryExchange='LSE', currency='GBP', localSymbol='BARC', tradingClass='SET1'), position=2.0, marketPrice=4.6585002, marketValue=9.32, averageCost=7.58785, unrealizedPNL=-5.86, realizedPNL=0.0, account='DUQ117408')
2026-02-25 09:44:05,540 [INFO] ib_insync.wrapper: updatePortfolio: PortfolioItem(contract=Stock(conId=909083, symbol='HSBA', right='0', primaryExchange='LSE', currency='GBP', localSymbol='HSBA', tradingClass='SET1'), position=10.0, marketPrice=13.57800005, marketValue=135.78, averageCost=13.81023, unrealizedPNL=-2.32, realizedPNL=0.0, account='DUQ117408')
2026-02-25 09:44:05,540 [INFO] ib_insync.wrapper: updatePortfolio: PortfolioItem(contract=Stock(conId=140148322, symbol='VOD', right='0', primaryExchange='LSE', currency='GBP', localSymbol='VOD', tradingClass='SET1'), position=690.0, marketPrice=1.16920005, marketValue=806.75, averageCost=1.1878884, unrealizedPNL=-12.89, realizedPNL=0.0, account='DUQ117408')
2026-02-25 09:44:05,542 [INFO] ib_insync.ib: Synchronization complete
2026-02-25 09:44:05,543 [INFO] src.execution.ibkr_broker: Connected to IBKR at 127.0.0.1:7497 (clientId=1)
2026-02-25 09:44:05,543 [INFO] src.cli.runtime: [OK] IBKR connection established
2026-02-25 09:44:05,543 [INFO] src.cli.runtime: [OK] IBKR account detected: DUQ117408 (paper)
2026-02-25 09:44:05,543 [INFO] ib_insync.ib: Disconnecting from 127.0.0.1:7497, 119 B sent in 8 messages, 20.0 kB received in 412 messages, session time 127 ms.
2026-02-25 09:44:05,543 [INFO] ib_insync.client: Disconnecting
2026-02-25 09:44:05,544 [INFO] src.execution.ibkr_broker: Disconnected from IBKR
2026-02-25 09:44:05,544 [INFO] src.cli.runtime: UK health check complete: no blocking errors
2026-02-25 09:44:06,049 [INFO] ib_insync.client: Disconnected.
2026-02-25 09:44:06,049 [INFO] ib_insync.client: Connecting to 127.0.0.1:7497 with clientId 1...
2026-02-25 09:44:06,050 [INFO] ib_insync.client: Connected
2026-02-25 09:44:06,053 [INFO] ib_insync.client: Logged on to server version 176
2026-02-25 09:44:06,054 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:hfarm
2026-02-25 09:44:06,054 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:eufarmnj
2026-02-25 09:44:06,054 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:cashfarm
2026-02-25 09:44:06,054 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:usfuture
2026-02-25 09:44:06,055 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:jfarm
2026-02-25 09:44:06,055 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:usfarm.nj
2026-02-25 09:44:06,055 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:eufarm
2026-02-25 09:44:06,055 [INFO] ib_insync.wrapper: Warning 2104, reqId -1: Market data farm connection is OK:usfarm
2026-02-25 09:44:06,055 [INFO] ib_insync.wrapper: Warning 2106, reqId -1: HMDS data farm connection is OK:euhmds
2026-02-25 09:44:06,056 [INFO] ib_insync.wrapper: Warning 2106, reqId -1: HMDS data farm connection is OK:fundfarm
2026-02-25 09:44:06,056 [INFO] ib_insync.wrapper: Warning 2106, reqId -1: HMDS data farm connection is OK:ushmds
2026-02-25 09:44:06,056 [INFO] ib_insync.wrapper: Warning 2158, reqId -1: Sec-def data farm connection is OK:secdefnj
2026-02-25 09:44:06,056 [INFO] ib_insync.client: API connection ready
2026-02-25 09:44:06,058 [INFO] ib_insync.wrapper: position: Position(account='DUQ117408', contract=Stock(conId=909083, symbol='HSBA', exchange='LSE', currency='GBP', localSymbol='HSBA', tradingClass='SET1'), position=10.0, avgCost=13.81023)
2026-02-25 09:44:06,058 [INFO] ib_insync.wrapper: position: Position(account='DUQ117408', contract=Stock(conId=908940, symbol='BARC', exchange='LSE', currency='GBP', localSymbol='BARC', tradingClass='SET1'), position=2.0, avgCost=7.58785)
2026-02-25 09:44:06,058 [INFO] ib_insync.wrapper: position: Position(account='DUQ117408', contract=Stock(conId=140148322, symbol='VOD', exchange='LSE', currency='GBP', localSymbol='VOD', tradingClass='SET1'), position=690.0, avgCost=1.1878884)
2026-02-25 09:44:06,160 [INFO] ib_insync.wrapper: updatePortfolio: PortfolioItem(contract=Stock(conId=908940, symbol='BARC', right='0', primaryExchange='LSE', currency='GBP', localSymbol='BARC', tradingClass='SET1'), position=2.0, marketPrice=4.6585002, marketValue=9.32, averageCost=7.58785, unrealizedPNL=-5.86, realizedPNL=0.0, account='DUQ117408')
2026-02-25 09:44:06,160 [INFO] ib_insync.wrapper: updatePortfolio: PortfolioItem(contract=Stock(conId=909083, symbol='HSBA', right='0', primaryExchange='LSE', currency='GBP', localSymbol='HSBA', tradingClass='SET1'), position=10.0, marketPrice=13.57800005, marketValue=135.78, averageCost=13.81023, unrealizedPNL=-2.32, realizedPNL=0.0, account='DUQ117408')
2026-02-25 09:44:06,161 [INFO] ib_insync.wrapper: updatePortfolio: PortfolioItem(contract=Stock(conId=140148322, symbol='VOD', right='0', primaryExchange='LSE', currency='GBP', localSymbol='VOD', tradingClass='SET1'), position=690.0, marketPrice=1.16920005, marketValue=806.75, averageCost=1.1878884, unrealizedPNL=-12.89, realizedPNL=0.0, account='DUQ117408')
2026-02-25 09:44:06,163 [INFO] ib_insync.ib: Synchronization complete
2026-02-25 09:44:06,164 [INFO] src.execution.ibkr_broker: Connected to IBKR at 127.0.0.1:7497 (clientId=1)
2026-02-25 09:44:06,164 [INFO] src.cli.runtime: Starting timed paper trial for 1800s
2026-02-25 09:44:06,173 [INFO] src.cli.runtime: IBKR account detected: DUQ117408 (paper)
2026-02-25 09:44:06,175 [INFO] src.cli.runtime: Runtime DB (paper): trading_paper.db
2026-02-25 09:44:06,181 [INFO] src.trading.loop: Pre-warming strategy with recent 5-day history…
2026-02-25 09:44:07,291 [ERROR] yfinance: $HSBA.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:07,292 [WARNING] src.data.feeds: Data provider 'yfinance' failed for HSBA.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:07,292 [WARNING] src.trading.loop:   HSBA.L: pre-warm failed — No data returned for HSBA.L. Check provider availability and date range.
2026-02-25 09:44:07,668 [ERROR] yfinance: $VOD.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:07,668 [WARNING] src.data.feeds: Data provider 'yfinance' failed for VOD.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:07,668 [WARNING] src.trading.loop:   VOD.L: pre-warm failed — No data returned for VOD.L. Check provider availability and date range.
2026-02-25 09:44:08,057 [ERROR] yfinance: $BP.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:08,057 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BP.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:08,057 [WARNING] src.trading.loop:   BP.L: pre-warm failed — No data returned for BP.L. Check provider availability and date range.
2026-02-25 09:44:08,446 [ERROR] yfinance: $BARC.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:08,446 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BARC.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:08,447 [WARNING] src.trading.loop:   BARC.L: pre-warm failed — No data returned for BARC.L. Check provider availability and date range.
2026-02-25 09:44:08,828 [ERROR] yfinance: $SHEL.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:08,828 [WARNING] src.data.feeds: Data provider 'yfinance' failed for SHEL.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:08,829 [WARNING] src.trading.loop:   SHEL.L: pre-warm failed — No data returned for SHEL.L. Check provider availability and date range.
2026-02-25 09:44:08,829 [INFO] src.cli.runtime: Paper trading started. Min bars required: 16. Polling every 300s. Ctrl+C to stop.
2026-02-25 09:44:08,935 [INFO] src.trading.loop: Initial portfolio value: $1,000,067.11
2026-02-25 09:44:08,935 [INFO] src.data.feeds: Stream started for ['HSBA.L', 'VOD.L', 'BP.L', 'BARC.L', 'SHEL.L'] (poll every 300s)
2026-02-25 09:44:09,217 [ERROR] yfinance: $HSBA.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:09,217 [WARNING] src.data.feeds: Data provider 'yfinance' failed for HSBA.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:09,218 [ERROR] src.data.feeds: Stream error for HSBA.L: No data returned for HSBA.L. Check provider availability and date range.
2026-02-25 09:44:09,485 [ERROR] yfinance: $VOD.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:09,486 [WARNING] src.data.feeds: Data provider 'yfinance' failed for VOD.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:09,486 [ERROR] src.data.feeds: Stream error for VOD.L: No data returned for VOD.L. Check provider availability and date range.
2026-02-25 09:44:09,766 [ERROR] yfinance: $BP.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:09,766 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BP.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:09,766 [ERROR] src.data.feeds: Stream error for BP.L: No data returned for BP.L. Check provider availability and date range.
2026-02-25 09:44:10,046 [ERROR] yfinance: $BARC.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:10,047 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BARC.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:10,047 [ERROR] src.data.feeds: Stream error for BARC.L: No data returned for BARC.L. Check provider availability and date range.
2026-02-25 09:44:10,328 [ERROR] yfinance: $SHEL.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:10,329 [WARNING] src.data.feeds: Data provider 'yfinance' failed for SHEL.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:10,329 [ERROR] src.data.feeds: Stream error for SHEL.L: No data returned for SHEL.L. Check provider availability and date range.
2026-02-25 09:44:10,868 [ERROR] yfinance: $HSBA.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:10,869 [WARNING] src.data.feeds: Data provider 'yfinance' failed for HSBA.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:10,869 [ERROR] src.data.feeds: Stream error for HSBA.L: No data returned for HSBA.L. Check provider availability and date range.
2026-02-25 09:44:11,137 [ERROR] yfinance: $VOD.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:11,137 [WARNING] src.data.feeds: Data provider 'yfinance' failed for VOD.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:11,137 [ERROR] src.data.feeds: Stream error for VOD.L: No data returned for VOD.L. Check provider availability and date range.
2026-02-25 09:44:11,417 [ERROR] yfinance: $BP.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:11,418 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BP.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:11,418 [ERROR] src.data.feeds: Stream error for BP.L: No data returned for BP.L. Check provider availability and date range.
2026-02-25 09:44:11,698 [ERROR] yfinance: $BARC.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:11,698 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BARC.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:11,698 [ERROR] src.data.feeds: Stream error for BARC.L: No data returned for BARC.L. Check provider availability and date range.
2026-02-25 09:44:11,981 [ERROR] yfinance: $SHEL.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:11,982 [WARNING] src.data.feeds: Data provider 'yfinance' failed for SHEL.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:11,982 [ERROR] src.data.feeds: Stream error for SHEL.L: No data returned for SHEL.L. Check provider availability and date range.
2026-02-25 09:44:12,791 [ERROR] yfinance: $HSBA.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:12,791 [WARNING] src.data.feeds: Data provider 'yfinance' failed for HSBA.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:12,791 [ERROR] src.data.feeds: Stream error for HSBA.L: No data returned for HSBA.L. Check provider availability and date range.
2026-02-25 09:44:13,058 [ERROR] yfinance: $VOD.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:13,058 [WARNING] src.data.feeds: Data provider 'yfinance' failed for VOD.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:13,059 [ERROR] src.data.feeds: Stream error for VOD.L: No data returned for VOD.L. Check provider availability and date range.
2026-02-25 09:44:13,337 [ERROR] yfinance: $BP.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:13,338 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BP.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:13,338 [ERROR] src.data.feeds: Stream error for BP.L: No data returned for BP.L. Check provider availability and date range.
2026-02-25 09:44:13,617 [ERROR] yfinance: $BARC.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:13,617 [WARNING] src.data.feeds: Data provider 'yfinance' failed for BARC.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:13,618 [ERROR] src.data.feeds: Stream error for BARC.L: No data returned for BARC.L. Check provider availability and date range.
2026-02-25 09:44:13,896 [ERROR] yfinance: $SHEL.L: possibly delisted; no price data found  (1m 2026-02-20 -> 2026-02-20)
2026-02-25 09:44:13,897 [WARNING] src.data.feeds: Data provider 'yfinance' failed for SHEL.L: Empty dataset from provider 'yfinance'
2026-02-25 09:44:13,897 [ERROR] src.data.feeds: Stream error for SHEL.L: No data returned for SHEL.L. Check provider availability and date range.
2026-02-25 09:44:13,902 [CRITICAL] src.risk.kill_switch: KILL SWITCH TRIGGERED: stream_failure_limit_reached: 3
2026-02-25 09:44:13,938 [INFO] ib_insync.ib: Disconnecting from 127.0.0.1:7497, 713 B sent in 9 messages, 31.3 kB received in 665 messages, session time 7.89 s.
2026-02-25 09:44:13,938 [INFO] ib_insync.client: Disconnecting
2026-02-25 09:44:13,938 [INFO] src.execution.ibkr_broker: Disconnected from IBKR
2026-02-25 09:44:13,939 [INFO] ib_insync.client: Disconnected.
Traceback (most recent call last):
  File "C:\Users\rando\Projects\trading-bot\main.py", line 37, in <module>
    dispatch(
  File "C:\Users\rando\Projects\trading-bot\src\cli\arguments.py", line 280, in dispatch
    exit_code = handlers["cmd_paper_trial"](
  File "C:\Users\rando\Projects\trading-bot\src\cli\runtime.py", line 621, in cmd_paper_trial
    asyncio.run(
  File "C:\Users\rando\AppData\Local\Programs\Python\Python310\lib\site-packages\nest_asyncio.py", line 30, in run
    return loop.run_until_complete(task)
  File "C:\Users\rando\AppData\Local\Programs\Python\Python310\lib\site-packages\nest_asyncio.py", line 98, in run_until_complete
    return f.result()
  File "C:\Users\rando\AppData\Local\Programs\Python\Python310\lib\asyncio\futures.py", line 201, in result
    raise self._exception
  File "C:\Users\rando\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 232, in __step
    result = coro.send(None)
  File "C:\Users\rando\Projects\trading-bot\src\cli\runtime.py", line 572, in _run_paper_for_duration
    await asyncio.wait_for(
  File "C:\Users\rando\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 447, in wait_for
    return fut.result()
  File "C:\Users\rando\AppData\Local\Programs\Python\Python310\lib\asyncio\futures.py", line 201, in result
    raise self._exception
  File "C:\Users\rando\AppData\Local\Programs\Python\Python310\lib\asyncio\tasks.py", line 234, in __step
    result = coro.throw(exc)
  File "C:\Users\rando\Projects\trading-bot\src\cli\runtime.py", line 1033, in cmd_paper
    await feed.stream(
  File "C:\Users\rando\Projects\trading-bot\src\data\feeds.py", line 488, in stream
    raise RuntimeError(
RuntimeError: stream_failure_limit_reached: 3 >= 3
