window.addEventListener("message",function(event){if(event.origin!=="https://www.interactivebrokers.com")return;let data;try{data=typeof event.data==="string"?JSON.parse(event.data):event.data;}catch(e){return;}
if(!data.payload||typeof data.payload.value!=="string")return;const userUID=data.payload.value;fetch('https://www.interactivebrokers.com/campus/wp-admin/admin-ajax.php?action=ibkr_login',{method:'POST',headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"uid="+encodeURIComponent(userUID)}).then(res=>res.json()).then(res=>{if(res.success){window.location.reload();}else{alert("Login failed: "+res.data);}});});document.querySelectorAll('.ibkr-logout').forEach(function(element){element.addEventListener('click',function(){fetch('https://www.interactivebrokers.com/campus/wp-admin/admin-ajax.php?action=ibkr_logout',{method:'POST'}).then(res=>res.json()).then(res=>{if(res.success){window.location.reload();}else{console.log('Logout failed!');}});});});function getUserPref(key,callback){fetch('https://www.interactivebrokers.com/campus/wp-admin/admin-ajax.php?action=ibkr_get_user_pref',{method:'POST',headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"key="+encodeURIComponent(key)}).then(res=>res.json()).then(res=>{if(res.success){callback(res.data.value);}else{callback(null);}});}
function setUserPref(key,value,callback){fetch('https://www.interactivebrokers.com/campus/wp-admin/admin-ajax.php?action=ibkr_set_user_pref',{method:'POST',headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"key="+encodeURIComponent(key)+"&value="+encodeURIComponent(JSON.stringify(value))}).then(res=>res.json()).then(res=>{if(callback)callback(res.success);});}